@(
  title: String,
  maybeTeamAccess: Option[models.accounts.UserTeamAccess],
  pageId: String = ""
  )(content: Html)(implicit messages: Messages, r: RequestHeader)

@import helper._
@navBorderColorForPage = @{if (pageId == "intro") " border-blue-medium " else " border-pink "}
@navBgColorForPage = @{if (maybeTeamAccess.exists(_.isAdminAccess)) " bg-pink " else " bg-blue-dark "}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>@title</title>
    <link rel="stylesheet" href="/assets/lib/codemirror/lib/codemirror.css">
    <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700|Source+Sans+Pro:400,300,600,400italic,300italic,600italic' rel='stylesheet' type='text/css'>
    <link rel='stylesheet' href='@routes.Assets.versioned("stylesheets/main.css")'>
    <!-- For IE 9 and below. ICO should be 32x32 pixels in size -->
    <!--[if IE]><link rel="shortcut icon" href="/assets/images/favicon.ico"><![endif]-->

    <!-- IE 10+ "Metro" Tiles - 144x144 pixels in size icon should be transparent -->
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="/assets/images/favicon-144x144.png">

    <!-- Touch Icons - iOS and Android 2.1+ 152x152 pixels in size. -->
    <link rel="apple-touch-icon-precomposed" href="/assets/images/favicon-apple-152x152.png">

    <!-- Firefox, Chrome, Safari, IE 11+ and Opera. 96x96 pixels in size. -->
    <link rel="icon" href="/assets/images/favicon-256x256.png" sizes="256x256">
    <link rel="icon" href="/assets/images/favicon-96x96.png" sizes="96x96">
    <link rel="icon" href="/assets/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" href="/assets/images/favicon-16x16.png" sizes="16x16">
  </head>
  <body class="bg-lightest">
    <header class='@("border-emphasis-bottom type-white " + navBgColorForPage + navBorderColorForPage)'>
      <div class="container">
        <div class="columns columns-elastic">
          <div class="column column-expand pts pbxs">
            <a href='@routes.ApplicationController.index(maybeTeamAccess.flatMap(_.maybeAdminAccessToTeamId))'
              class="link-green display-inline-block align-b" style="height: 36px">
              @if(maybeTeamAccess.exists(_.isAdminAccess)) {
                <div class="type-l mobile-ptxs">ðŸ‘»</div>
              } else {
                <span class="mobile-display-none">@views.html.logo()</span>
                <span class="mobile-display-only">@views.html.logoSymbol()</span>
              }
            </a>

            <a class="link-light display-inline-block align-button mhm"
              href='@routes.ApplicationController.index(maybeTeamAccess.flatMap(_.maybeAdminAccessToTeamId))'>Behaviors</a>
          </div>
          @maybeTeamAccess.map { teamAccess =>
            <div class="column column-shrink align-r pts pbxs">
              <form action='@routes.SocialAuthController.signOut()' method="POST" id="main-user-menu-container">
                @CSRF.formField
                <span class="link-light">
                  <button class="button-subtle button-dropdown-trigger button-dropdown-trigger-no-icon mobile-phs" type="button" id="main-user-menu-button">
                    <span class="display-inline-block align-t">
                      @views.html.teamSymbol()
                    </span>
                    @teamAccess.maybeAdminAccessToTeam.map { team =>
                      <span class="type-label display-inline-block align-t ptxs mlxs">
                        @team.name
                      </span>
                    }.getOrElse {
                      @teamAccess.maybeTargetTeam.flatMap(_.maybeNonEmptyName.map(name => {
                        <span class="type-label display-inline-block align-t ptxs mlxs mobile-display-none">{name}</span>
                      })).getOrElse("")
                    }
                  </button>
                </span>
                <div class="position-relative type-black">
                  <ul class="type-s popup popup-dropdown-menu popup-dropdown-menu-right fade-in" id="main-user-menu" style="display: none">
                    @teamAccess.loggedInTeam.maybeNonEmptyName.map(name => {
                      <li class='type-disabled align-l phl pvs display-ellipsis'>Signed into {name}</li>
                    }).getOrElse("")
                    <li><button type="submit" class="button-dropdown-item">Sign out</button></li>
                  </ul>
                </div>
              </form>
              <script>
                (function() {
                  var userMenuButton = document.getElementById('main-user-menu-button');
                  var userMenu = document.getElementById('main-user-menu');
                  var addClass = function(el, className) {
                    var classes = el.className.replace(/\s+/g, ' ').split(' ');
                    if (!classes.find(function(cl) { return cl.trim() === className; })) {
                      classes.push(className);
                      el.className = classes.join(' ');
                    }
                  };
                  var removeClass = function(el, className) {
                    var classes = el.className.replace(/\s+/g, ' ').split(' ');
                    var newClasses = classes.filter(function(cl) { return cl !== className; });
                    el.className = newClasses.join(' ');
                  };
                  userMenuButton.addEventListener('click', function(event) {
                    var oldStyle = userMenu.style.display;
                    userMenu.style.display = oldStyle === 'none' ? '' : 'none';
                    if (oldStyle === 'none') {
                      addClass(userMenuButton, 'button-dropdown-trigger-menu-open');
                    } else {
                      removeClass(userMenuButton, 'button-dropdown-trigger-menu-open');
                    }
                    event.stopPropagation();
                    event.preventDefault();
                  });
                  document.addEventListener('click', function() {
                    if (userMenu.style.display !== 'none') {
                      userMenu.style.display = 'none';
                      removeClass(userMenuButton, 'button-dropdown-trigger-menu-open');
                    }
                  });
                })();
              </script>
            </div>
          }
        </div>
      </div>
    </header>
    <script>
      requirejs = {
        paths: {
          '../common': '@routes.Assets.versioned("javascripts/common.js").absoluteURL(true).replaceFirst("\\.js$", "")'
        }
      };
    </script>
    @content
  </body>
  <script>window.document.body.addEventListener('touchstart', function() {})</script>
</html>
